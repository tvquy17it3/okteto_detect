<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Title</title>
    </head>
    <body>
    <video id="video" width="640" height="480" autoplay></video>
    <button id="snap">Snap Photo</button>
    <canvas id="canvas" width="640" height="480"></canvas>
    </body>
    <script>
      console.log("scrips");
        var video = document.getElementById('video');

        if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
          console.log(video);
          navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
            //video.src = window.URL.createObjectURL(stream);
            video.srcObject = stream;
            video.play();
          });
        }else{
          console.log("false");
        }

        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');
        var video = document.getElementById('video');

        // Trigger photo take
        document.getElementById("snap").addEventListener("click", function() {
          // context.drawImage(video, 0, 0, 640, 480);
          var params = canvas.toDataURL();
          const url = "/submit";
          start(url, params);

          // var request = new XMLHttpRequest();
          // request.open('POST', '/submit', true);
          // //Send the proper header information along with the request
          // request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

          // request.onreadystatechange = function() {//Call a function when the state changes.
          //   if(request.readyState == 4 && request.status == 200) {
          //       alert(request.responseText);
          //   }
          // }
          // request.send(params);
        });

        const start = async function(url,result) {
          base64Img = result.replace("data:image/png;base64,", "");
          const response = await fetch(url, {
              method: 'POST',
              headers: {
                  Accept: 'application/json',
                  'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                  image: base64Img,
                  user_id: 5,
              })
          });
          const json = await response.json();
          console.log(json);
        }
	</script>
	</html>
